
# Download msi package manager for Windows  

- name: Get splunk-otel-collctor for windows
  ansible.windows.win_get_url:
    url: "{{windows_base_url}}/splunk-otel-collector/msi/{{package_stage}}/{{win_otel_msi}}"
    dest: C:\Users\{{win_otel_msi}}
  register: msi_package_download

# Check for existing splunk-otel-collector Installation
- name: Check if splunk-otel-collector service is installed
  ansible.windows.win_service:
    name: splunk-otel-collector
  register: service_info

# Uninstall existing splunk-otel-collector service
- name: Delete previous splunk-otel-collector service if exist
  ansible.windows.win_service:
    name: splunk-otel-collector
    state: absent
  when: service_info.exists

- name: install splunk-otel-collector-msi
  ansible.windows.win_package:
    path:  C:\Users\{{win_otel_msi}}
    state: present