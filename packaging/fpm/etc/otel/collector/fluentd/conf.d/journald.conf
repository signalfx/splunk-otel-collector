# Default fluentd source config to read from journald and forward all log events
# to the Splunk OpenTelemetry Collector.
#
# To manually enable this source, perform the following steps:
#
# 1. Ensure the systemd fluentd plugin is installed by running:
#
#      td-agent-gem list fluent-plugin-systemd
#
#    If necessary, install the plugin by running:
#
#      td-agent-gem install fluent-plugin-systemd
#
#    Note: Additional dependencies may be required to be installed/upgraded in
#    order to successfully install the plugin. See
#    https://github.com/fluent-plugin-systemd/fluent-plugin-systemd for
#    installation and configuration details.
#
# 2. Ensure that the fluentd service is configured to forward events to the
#    collector by checking if the drop-in file
#    "/etc/systemd/system/td-agent.service.d/splunk-otel-collector.conf"
#    exists.  If not, copy "/etc/otel/collector/splunk-otel-collector.conf" to
#    "/etc/systemd/system/td-agent.service.d/splunk-otel-collector.conf" and
#    run:
#
#      systemctl daemon-reload
#
# 3. Make any necessary changes to the configuration below.  See
#    https://github.com/fluent-plugin-systemd/fluent-plugin-systemd for
#    details and other options.
#
# 4. Since the fluentd service runs as the "td-agent" user, ensure that this
#    user has permissions to access the path configured below.  For example, if
#    the "/var/log/journal" path is only readable by the "systemd-journal"
#    group, it may be necessary to add the "td-agent" user to the group by
#    running the command:
#
#      usermod -a -G systemd-journal td-agent
#
#    Alternatively, see https://docs.fluentd.org/deployment/linux-capability
#    for installing/enabling the Linux capability module on fluentd.
#
# 5. Restart the fluentd service to apply the changes by running:
#
#      systemctl restart td-agent
#

<source>
  @type systemd
  @label @SPLUNK
  tag "journald"
  path "/var/log/journal"
  read_from_head false
  <storage>
    @type local
    persistent true
    path /var/log/td-agent/journald.var.pos.json
  </storage>
  <entry>
    fields_strip_underscores true
    fields_lowercase true
  </entry>
</source>

<source>
  @type systemd
  @label @SPLUNK
  tag "journald"
  path "/run/log/journal"
  read_from_head false
  <storage>
    @type local
    persistent true
    path /var/log/td-agent/journald.run.pos.json
  </storage>
  <entry>
    fields_strip_underscores true
    fields_lowercase true
  </entry>
</source>
