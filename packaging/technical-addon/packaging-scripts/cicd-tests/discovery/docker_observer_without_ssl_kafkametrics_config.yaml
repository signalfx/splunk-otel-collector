extensions:
  host_observer:

receivers:
  discovery:
    embed_receiver_config: true
    receivers:
      kafkametrics:
        config:
          client_id: "otel-integration-test"
          protocol_version: "2.0.0"
          scrapers:
            - brokers
        rule: type == "hostport" and any([name, image, command], {# matches "(?i)(.*)kafka(.*)"}) and not (command matches "splunk.discovery")
    watch_observers:
      - host_observer

processors:

exporters:
  debug:
    verbosity: detailed

service:
  telemetry:
    logs:
      level: debug
      output_paths: [ "${env:SPLUNK_HOME}/var/log/splunk/otel.log" ]
  extensions:
    - host_observer
  pipelines:
    logs:
      receivers: ["discovery"]
      exporters: ["debug"]
