extensions:
  docker_observer:
    endpoint: ${DOCKER_DOMAIN_SOCKET}
  zpages:
    endpoint: "0.0.0.0:55679"
    expvar:
      enabled: true
exporters:
  otlp_grpc:
    endpoint: ${OTLP_ENDPOINT}
    tls:
      insecure: true
processors:
  filter:
    metrics:
      include:
        match_type: strict
        metric_names: [prometheus_tsdb_exemplar_exemplars_in_storage]
receivers:
  discovery/docker_observer:
    embed_receiver_config: true
    receivers:
      prometheus_simple:
        config:
          collection_interval: 1s
          labels:
            label_five: actual.label.five.value
            label_four: actual.label.four.value
            label_one: ${LABEL_ONE_VALUE}
            label_three: actual.label.three.value
            label_two: ${LABEL_TWO_VALUE}
        rule: type == "container" and labels['test.id'] == '${SPLUNK_TEST_ID}' and port == 9090
    watch_observers: [docker_observer]
service:
  extensions: [zpages, docker_observer]
  pipelines:
    metrics:
      exporters: [otlp_grpc]
      processors: [filter]
      receivers: [discovery/docker_observer]
  telemetry:
    metrics:
      level: none
    resource:
      splunk_autodiscovery: "true"